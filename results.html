<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Form Results</title>
</head>
<body>
  <h1>Results</h1>
  <p>Since this is a shared sheet, this means that other people who are on this site could also see your results. To prevent this as much as possible we suggest using the steps laid out below. </p>
  <p> Steps to retrieve your results:<br>
    1. Fill in your chosen identifier in the indicated box<br>
    (optional) Fill in a target maturity<br>
  2. When you're done, Remove your identifier (and target maturity)</p>
  <iframe src="https://docs.google.com/spreadsheets/d/1xIJG2PtImOZtyBr6W1-Dpg06eis6YUb3GyMI1xXqHpM/edit?usp=sharing"  
    width="900" height="600">
  </iframe>
  <br>
  <!--
  <button 
  onclick="window.open('https://docs.google.com/spreadsheets/d/1xIJG2PtImOZtyBr6W1-Dpg06eis6YUb3GyMI1xXqHpM/export?format=pdf&gid=1778117427&size=letter&portrait=false', '_blank')" 
  style="
    font-size: 24px;      /* Larger font size */
    padding: 20px 40px;   /* Bigger padding for width and height */
    border-radius: 10px;  /* Rounded corners */
    cursor: pointer;      /* Pointer cursor on hover */
    background-color: green;   /* Green background */
    color: white;              /* White text */
    border: none;              /* Remove default border */
  ">
  Download Results PDF
</button>
  -->
  <button onclick="location.href='index.html'"style="
    font-size: 24px;      /* Larger font size */
    padding: 20px 40px;   /* Bigger padding for width and height */
    border-radius: 10px;  /* Rounded corners */
    cursor: pointer;      /* Pointer cursor on hover */
    background-color: purple;   /* Green background */
    color: white;              /* White text */
    border: none;              /* Remove default border */
  ">Back to Form</button>
<h1>Sheet Data and Charts</h1>

  <form id="inputForm">
    <label for="b3">Value for B3:</label>
    <input type="text" id="b3" name="b3" required />
    <br />
    <label for="b7">Value for B7:</label>
    <input type="text" id="b7" name="b7" required />
    <br />
    <button type="submit">Submit</button>
  </form>

  <h2>Sheet Data</h2>
  <div id="sheetData"></div>

  <h2>Charts</h2>
  <div id="chartsContainer"></div>

  <script>
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbz0eR7WzMek4o4Ijksm_mNUPSoTxGuiLFOGDQKsFe1Z86DJWpyomnjF5-w2LumUXjNw/exec'; // Replace with your Apps Script Web App URL

    const form = document.getElementById('inputForm');
    const sheetDataDiv = document.getElementById('sheetData');
    const chartsContainer = document.getElementById('chartsContainer');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const valueForB3 = document.getElementById('b3').value.trim();
      const valueForB7 = document.getElementById('b7').value.trim();

      try {
        const response = await fetch(webAppUrl, {
          method: 'POST',
          body: JSON.stringify({ valueForB3, valueForB7 }),
          headers: {
            'Content-Type': 'application/json',
          },
        });

        const data = await response.json();

        if (data.status !== 'success') {
          sheetDataDiv.innerHTML = 'Error: ' + (data.message || 'Unknown error');
          chartsContainer.innerHTML = '';
          return;
        }

        displaySheetData(data.data);
        displayCharts(data.charts);
      } catch (error) {
        sheetDataDiv.innerHTML = 'Request failed: ' + error.message;
        chartsContainer.innerHTML = '';
      }
    });

    function displaySheetData(data) {
      if (!Array.isArray(data) || data.length === 0) {
        sheetDataDiv.innerHTML = '<p>No data available.</p>';
        return;
      }

      let html = '<table><tbody>';
      data.forEach(row => {
        html += '<tr>';
        row.forEach(cell => {
          html += `<td>${cell !== null && cell !== undefined ? cell : ''}</td>`;
        });
        html += '</tr>';
      });
      html += '</tbody></table>';

      sheetDataDiv.innerHTML = html;
    }

    function displayCharts(charts) {
      chartsContainer.innerHTML = '';
      if (!Array.isArray(charts) || charts.length === 0) {
        chartsContainer.innerHTML = '<p>No charts available.</p>';
        return;
      }

      charts.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        chartsContainer.appendChild(img);
      });
    }
  </script>
  
</body>
</html>
